# –ó–ê–î–ê–ù–ò–Ø –î–õ–Ø –ú–ê–¢–ï–ú–ê–¢–ò–ö–û–í - SCARLET SAILS TRADING SYSTEM

**–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:** 2025-11-13
**–î–µ–¥–ª–∞–π–Ω:** 2025-11-15 (–≤–µ—á–µ—Ä) - **48 —á–∞—Å–æ–≤**
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è –î–µ–Ω—å 3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## üéØ –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê

–ú—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏ —Å —Ç—Ä–µ–º—è –º–æ–¥–µ–ª—è–º–∏:
1. **Rule-Based** - –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (RSI, EMA, Volume)
2. **ML XGBoost** - –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (gradient boosting, 31 –ø—Ä–∏–∑–Ω–∞–∫)
3. **Hybrid** - –∫–æ–º–±–∏–Ω–∞—Ü–∏—è Rule-Based + ML + —Ñ–∏–ª—å—Ç—Ä—ã

**–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
```
P_j(S) = ML(market_state) ¬∑ ‚àè_k I_k + opportunity(S) - costs(S) - risk_penalty(S) + Œ≥¬∑E[V_future]
```

**–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å P_j(S) ‚Üí –º–∞–∫—Å–∏–º—É–º –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–º —Ä–∏—Å–∫–µ

---

## ‚è∞ –î–ï–î–õ–ê–ô–ù–´ –ò –ü–†–ò–û–†–ò–¢–ï–¢–´

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–î–ê–ß–ò (–î–µ–¥–ª–∞–π–Ω: 2025-11-15 20:00)

–≠—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è **–î–µ–Ω—å 3** (2025-11-16) –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –∫–æ–¥.

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –í—Ä–µ–º—è | –ù—É–∂–Ω–æ –¥–ª—è |
|--------|-----------|-------|-----------|
| **#1 Regime Detection** | üî¥ –ö–†–ò–¢–ò–ß–ù–û | 8-12 —á–∞—Å–æ–≤ | –î–µ–Ω—å 3 - —Ñ–∏–ª—å—Ç—Ä—ã |
| **#2 Risk Aggregation** | üî¥ –ö–†–ò–¢–ò–ß–ù–û | 4-6 —á–∞—Å–æ–≤ | –î–µ–Ω—å 2-3 - penalties |
| **#3 Class Imbalance** | üü† –í–´–°–û–ö–ò–ô | 3-4 —á–∞—Å–∞ | –î–µ–Ω—å 4 - retraining |

### –í–ê–ñ–ù–´–ï –ó–ê–î–ê–ß–ò (–î–µ–¥–ª–∞–π–Ω: 2025-11-17 20:00)

–≠—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ **–î–µ–Ω—å 4-5** –∏–ª–∏ –ø–æ—Å–ª–µ 1MVP.

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –í—Ä–µ–º—è | –ù—É–∂–Ω–æ –¥–ª—è |
|--------|-----------|-------|-----------|
| **#4 Feature Selection** | üü† –í–´–°–û–ö–ò–ô | 6-8 —á–∞—Å–æ–≤ | –î–µ–Ω—å 4 - opportunity |
| **#5 Weight Optimization** | üü° –°–†–ï–î–ù–ò–ô | 4-6 —á–∞—Å–æ–≤ | –î–µ–Ω—å 4 - opportunity |
| **#6 OOD Detection** | üü° –°–†–ï–î–ù–ò–ô | 4-5 —á–∞—Å–æ–≤ | 2MVP - ML —É–ª—É—á—à–µ–Ω–∏–µ |
| **#7 Layer Optimization** | üü¢ –ù–ò–ó–ö–ò–ô | 3-4 —á–∞—Å–∞ | 2MVP - Hybrid |

---

## üìä –ó–ê–î–ê–ß–ê #1: REGIME DETECTION (–ö–†–ò–¢–ò–ß–ù–û!)

**–î–µ–¥–ª–∞–π–Ω:** 2025-11-15 20:00
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ù–û
**–í—Ä–µ–º—è:** 8-12 —á–∞—Å–æ–≤
**–ù—É–∂–Ω–æ –¥–ª—è:** –î–µ–Ω—å 3 - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ I_regime –≤ Hybrid –º–æ–¥–µ–ª—å

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ù—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞ (BULL, BEAR, SIDEWAYS) –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–ó–∞—á–µ–º:**
- –§–∏–ª—å—Ç—Ä I_regime = 1 if regime ‚àà {BULL, SIDEWAYS} else 0
- –ù–µ —Ç–æ—Ä–≥–æ–≤–∞—Ç—å –≤ BEAR —Ä—ã–Ω–∫–µ (–∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ–ª—å—à–∏—Ö –ø—Ä–æ—Å–∞–¥–æ–∫)
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–µ–π –ø–æ–¥ —Ä–µ–∂–∏–º

### –î–∞–Ω–Ω—ã–µ

**–§–∞–π–ª:** `/home/user/scarlet-sails/data/raw/BTC_15m.csv`

**–°—Ç–æ–ª–±—Ü—ã:**
- `timestamp` (UTC)
- `open`, `high`, `low`, `close` (—Ü–µ–Ω–∞ BTC –≤ USD)
- `volume` (–æ–±—ä—ë–º —Ç–æ—Ä–≥–æ–≤)

**–†–∞–∑–º–µ—Ä:** 275,044 —Å–≤–µ—á–∏ (15-–º–∏–Ω—É—Ç–∫–∏ —Å 2018 –ø–æ 2024)

**–ü—Ä–∏–º–µ—Ä (–ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫):**
```csv
timestamp,open,high,low,close,volume
2018-01-01 00:00:00+00:00,13657.20,13657.20,13482.30,13563.90,48.50
2018-01-01 00:15:00+00:00,13563.90,13625.00,13563.90,13625.00,27.34
2018-01-01 00:30:00+00:00,13625.00,13625.00,13490.00,13490.00,41.67
...
```

### –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç A: Hidden Markov Model (HMM)**
- –°–∫—Ä—ã—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {BULL, BEAR, SIDEWAYS}
- –ù–∞–±–ª—é–¥–∞–µ–º—ã–µ: returns, volatility, volume
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `hmmlearn` (Python)
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: probabilistic, online updates
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç B: Regime-Switching GARCH**
- Markov-switching volatility model
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `arch` (Python)
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: —É—á–∏—Ç—ã–≤–∞–µ—Ç –≥–µ—Ç–µ—Ä–æ—Å–∫–µ–¥–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: —Å–ª–æ–∂–Ω–µ–µ, –¥–æ–ª—å—à–µ –æ–±—É—á–∞–µ—Ç—Å—è

**–í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä–æ—Å—Ç–æ–π —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π**
- SMA_50 > SMA_200 ‚Üí BULL
- SMA_50 < SMA_200 AND ATR < threshold ‚Üí SIDEWAYS
- –ò–Ω–∞—á–µ ‚Üí BEAR
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –±—ã—Å—Ç—Ä–æ, –ø–æ–Ω—è—Ç–Ω–æ
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –Ω–µ probabilistic

### –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å

**1. –í—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞**
- –ö–∞–∫–æ–π –∏–∑ A/B/C —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ –∏ –ø–æ—á–µ–º—É?
- –ò–ª–∏ –µ—Å—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (Hamilton filter, –¥—Ä—É–≥–æ–µ)?

**2. –ü—Å–µ–≤–¥–æ–∫–æ–¥/—Ñ–æ—Ä–º—É–ª—ã**
```python
# –ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞
def detect_regime(close_prices: np.ndarray,
                  volume: np.ndarray) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞

    Returns:
        'BULL', 'BEAR', –∏–ª–∏ 'SIDEWAYS'
    """
    # –í–∞—à–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∑–¥–µ—Å—å
    # –§–æ—Ä–º—É–ª—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø–æ—Ä–æ–≥–∏
    pass
```

**3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã**
- –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω—É–∂–Ω—ã? (window —Ä–∞–∑–º–µ—Ä—ã, –ø–æ—Ä–æ–≥–∏, etc.)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫—Ä–∏–ø—Ç—ã (–≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å)

**4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ö–∞–∫ –æ—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ? (accuracy, precision/recall per regime?)
- –ù—É–∂–Ω–∞ –ª–∏ —Ä–∞–∑–º–µ—á–µ–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞? (–º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é)

**5. Online –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**
- –ú–æ–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –º–æ–¥–µ–ª—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ? (–∫–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Å–≤–µ—á–∞)
- –ò–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–±—É—á–∞—Ç—å –≤—Å—é –º–æ–¥–µ–ª—å?

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```markdown
## –ó–ê–î–ê–ß–ê #1: REGIME DETECTION

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
[–ù–∞–∑–≤–∞–Ω–∏–µ: HMM / Regime-switching GARCH / –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π / –î—Ä—É–≥–æ–π]

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
[–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –ª—É—á—à–µ –¥–ª—è –∫—Ä–∏–ø—Ç—ã —Å –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å—é]

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å
[–§–æ—Ä–º—É–ª—ã, —É—Ä–∞–≤–Ω–µ–Ω–∏—è, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω–∞—è –º–æ–¥–µ–ª—å]

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- parameter1: –∑–Ω–∞—á–µ–Ω–∏–µ (–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)
- parameter2: –∑–Ω–∞—á–µ–Ω–∏–µ (–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)

### –ü—Å–µ–≤–¥–æ–∫–æ–¥
```python
def detect_regime(...):
    # –í–∞—à –∫–æ–¥
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
[–ö–∞–∫ –æ—Ü–µ–Ω–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –º–æ–¥–µ–ª—å —Ö–æ—Ä–æ—à–æ]

### Online –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
[–ú–æ–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ? –ö–∞–∫ —á–∞—Å—Ç–æ?]

### –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
[–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫, edge cases]
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–ú–∏–Ω–∏–º—É–º (acceptable):**
- –ü—Ä–æ—Å—Ç–æ–π —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü—Å–µ–≤–¥–æ–∫–æ–¥ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

‚úÖ **–•–æ—Ä–æ—à–æ (good):**
- HMM –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –¥–ª—è –∫—Ä–∏–ø—Ç—ã
- –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ **–û—Ç–ª–∏—á–Ω–æ (excellent):**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 2-3 –º–µ—Ç–æ–¥–æ–≤ (HMM vs —ç–≤—Ä–∏—Å—Ç–∏–∫–∞)
- –ü—Å–µ–≤–¥–æ–∫–æ–¥ + —Ç–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Python
- Online –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —Å–≤–µ—á–∏

---

## üìä –ó–ê–î–ê–ß–ê #2: RISK AGGREGATION (–ö–†–ò–¢–ò–ß–ù–û!)

**–î–µ–¥–ª–∞–π–Ω:** 2025-11-15 20:00
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ù–û
**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤
**–ù—É–∂–Ω–æ –¥–ª—è:** –î–µ–Ω—å 2-3 - RiskPenaltyCalculator

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ï—Å—Ç—å 4 —Ç–∏–ø–∞ risk penalties (—à—Ç—Ä–∞—Ñ–æ–≤):
1. **Volatility** (–≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å) - penalty_vol ‚àà [0, 0.01]
2. **Liquidity** (–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å) - penalty_liq ‚àà [0, 0.015]
3. **Crisis** (–∫—Ä–∏–∑–∏—Å) - penalty_crisis ‚àà [0, 0.03]
4. **OOD** (out-of-distribution) - penalty_ood ‚àà [0, 0.005]

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –∏—Ö –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –æ–¥–∏–Ω total_penalty?

### –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥

```python
# –ü—Ä–æ—Å—Ç–∞—è —Å—É–º–º–∞
total_penalty = penalty_vol + penalty_liq + penalty_crisis + penalty_ood
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- Penalties –º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω—ã (–≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —á–∞—Å—Ç–æ –∏–¥—ë—Ç —Å –Ω–∏–∑–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é)
- –ù–µ —É—á–∏—Ç—ã–≤–∞–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, OOD –æ—Å–æ–±–µ–Ω–Ω–æ –æ–ø–∞—Å–Ω–æ –≤–æ –≤—Ä–µ–º—è –∫—Ä–∏–∑–∏—Å–∞)
- –õ–∏–Ω–µ–π–Ω–∞—è —Å—É–º–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞

### –î–∞–Ω–Ω—ã–µ

–ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞ penalties:

```python
# –ü—Ä–∏–º–µ—Ä 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫
penalty_vol = 0.0      # ATR/close = 3% (–Ω–æ—Ä–º–∞)
penalty_liq = 0.0      # volume_ratio = 1.2 (–Ω–æ—Ä–º–∞)
penalty_crisis = 0.0   # crisis_level = 0
penalty_ood = 0.0      # OOD = 5% (–Ω–æ—Ä–º–∞)
‚Üí total = 0.0

# –ü—Ä–∏–º–µ—Ä 2: –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
penalty_vol = 0.008    # ATR/close = 9% (–≤—ã—Å–æ–∫–æ)
penalty_liq = 0.0      # volume_ratio = 1.0
penalty_crisis = 0.0   # crisis_level = 0
penalty_ood = 0.0      # OOD = 8%
‚Üí total = 0.008

# –ü—Ä–∏–º–µ—Ä 3: –ö—Ä–∏–∑–∏—Å (–≤—Å—ë –ø–ª–æ—Ö–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
penalty_vol = 0.01     # ATR/close = 12% (–ø–∞–Ω–∏–∫–∞)
penalty_liq = 0.012    # volume_ratio = 0.3 (–Ω–∏–∑–∫–æ)
penalty_crisis = 0.02  # crisis_level = 3
penalty_ood = 0.005    # OOD = 50%
‚Üí total = ??? (0.047 —Å—É–º–º–∞, –Ω–æ —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ?)
```

### –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –º–µ—Ç–æ–¥–æ–≤

**A. –õ–∏–Ω–µ–π–Ω–∞—è —Å—É–º–º–∞ (—Ç–µ–∫—É—â–∏–π)**
```python
total = penalty_vol + penalty_liq + penalty_crisis + penalty_ood
```

**B. –í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞**
```python
total = w1¬∑penalty_vol + w2¬∑penalty_liq + w3¬∑penalty_crisis + w4¬∑penalty_ood
```

**C. –ú–∞–∫—Å–∏–º—É–º (worst-case)**
```python
total = max(penalty_vol, penalty_liq, penalty_crisis, penalty_ood)
```

**D. L2 –Ω–æ—Ä–º–∞ (Euclidean)**
```python
total = ‚àö(penalty_vol¬≤ + penalty_liq¬≤ + penalty_crisis¬≤ + penalty_ood¬≤)
```

**E. Geometric mean**
```python
total = (penalty_vol ¬∑ penalty_liq ¬∑ penalty_crisis ¬∑ penalty_ood)^(1/4)
```

**F. –ù–µ–ª–∏–Ω–µ–π–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏**
```python
total = f(penalty_vol, penalty_liq, penalty_crisis, penalty_ood)
# –ù–∞–ø—Ä–∏–º–µ—Ä: penalty_ood –æ—Å–æ–±–µ–Ω–Ω–æ –æ–ø–∞—Å–Ω–æ –≤–æ –≤—Ä–µ–º—è crisis
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å

**1. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞**
- –ö–∞–∫–æ–π –∏–∑ A-F —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ?
- –ò–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Å–≤–æ–π (G)?

**2. –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**
- –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ª—É—á—à–µ –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è?
- –°–≤–æ–π—Å—Ç–≤–∞ (–º–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç—å, bounded, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)

**3. –£—á—ë—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**
- –ù—É–∂–Ω–æ –ª–∏ —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ penalties –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—Ç?
- –ù–∞–ø—Ä–∏–º–µ—Ä: OOD √ó Crisis (OOD –æ—Å–æ–±–µ–Ω–Ω–æ –æ–ø–∞—Å–Ω–æ –≤ –∫—Ä–∏–∑–∏—Å)

**4. –í–µ—Å–∞ (–µ—Å–ª–∏ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞)**
- –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å w1, w2, w3, w4?
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è?

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```markdown
## –ó–ê–î–ê–ß–ê #2: RISK AGGREGATION

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–µ—Ç–æ–¥
[A/B/C/D/E/F/G - –Ω–∞–∑–≤–∞–Ω–∏–µ]

### –§–æ—Ä–º—É–ª–∞
total_penalty = [—Ñ–æ—Ä–º—É–ª–∞]

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
[–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ª—É—á—à–µ –¥—Ä—É–≥–∏—Ö]

### –°–≤–æ–π—Å—Ç–≤–∞
- –ú–æ–Ω–æ—Ç–æ–Ω–Ω–æ—Å—Ç—å: [–¥–∞/–Ω–µ—Ç]
- Bounded: [0, max_value]
- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: [–≤—ã—Å–æ–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–Ω–∏–∑–∫–∞—è]

### –£—á—ë—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
[–ù—É–∂–Ω–æ –ª–∏, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ]

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–µ—Å–∞)
w1 = [–∑–Ω–∞—á–µ–Ω–∏–µ] (volatility)
w2 = [–∑–Ω–∞—á–µ–Ω–∏–µ] (liquidity)
w3 = [–∑–Ω–∞—á–µ–Ω–∏–µ] (crisis)
w4 = [–∑–Ω–∞—á–µ–Ω–∏–µ] (OOD)

### –ü—Ä–∏–º–µ—Ä—ã
–ü—Ä–∏–º–µ—Ä 3 (–∫—Ä–∏–∑–∏—Å): penalty_vol=0.01, penalty_liq=0.012, penalty_crisis=0.02, penalty_ood=0.005
‚Üí total = [—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –≤–∞—à–µ–π —Ñ–æ—Ä–º—É–ª–µ]

### –†–∏—Å–∫–∏
[–ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫]
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–ú–∏–Ω–∏–º—É–º:**
- –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –∏–∑ A-F —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º
- –§–æ—Ä–º—É–ª–∞ total_penalty

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 2-3 –º–µ—Ç–æ–¥–æ–≤
- –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤
- –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞

‚úÖ **–û—Ç–ª–∏—á–Ω–æ:**
- –ù–µ–ª–∏–Ω–µ–π–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏
- –í–µ—Å–∞ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 3 –ø—Ä–∏–º–µ—Ä–∞—Ö

---

## üìä –ó–ê–î–ê–ß–ê #3: CLASS IMBALANCE (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–î–µ–¥–ª–∞–π–Ω:** 2025-11-15 20:00
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –í–´–°–û–ö–ò–ô
**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞
**–ù—É–∂–Ω–æ –¥–ª—è:** –î–µ–Ω—å 4 - –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–∏

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

ML –º–æ–¥–µ–ª—å (XGBoost) –æ–±—É—á–∞–µ—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã:
- **UP (1):** –¶–µ–Ω–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç –Ω–∞ 1%+ –∑–∞ 24 —á–∞—Å–∞ ‚Üí 32% samples
- **DOWN (0):** –¶–µ–Ω–∞ –ù–ï –≤—ã—Ä–∞—Å—Ç–µ—Ç ‚Üí 68% samples

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–∏—Å–±–∞–ª–∞–Ω—Å 32/68 ‚Üí –º–æ–¥–µ–ª—å bias –∫ DOWN
- WinRate —Ö–æ—Ä–æ—à–∏–π (60%+), –Ω–æ –º–æ–∂–µ–º –ª—É—á—à–µ?

### –î–∞–Ω–Ω—ã–µ

**–û–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞:**
- Total samples: 39,339
- UP (1): 12,588 (32.0%)
- DOWN (0): 26,751 (68.0%)

**–¢–µ—Å—Ç–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞:**
- Total samples: 9,835
- UP (1): 3,148 (32.0%)
- DOWN (0): 6,687 (68.0%)

**Features:** 31 –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞ (returns, ratios, indicators)

### –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥

```python
# XGBoost —Å sample weights
class_weight_ratio = n_down / n_up = 2.13

model = XGBClassifier(
    scale_pos_weight=class_weight_ratio,  # –í–µ—Å –¥–ª—è –∫–ª–∞—Å—Å–∞ UP
    ...
)
```

### –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –º–µ—Ç–æ–¥–æ–≤

**A. Scale_pos_weight (—Ç–µ–∫—É—â–∏–π)**
```python
scale_pos_weight = n_down / n_up = 2.13
```

**B. Sample weights**
```python
sample_weights = [weight_up if y==1 else weight_down for y in y_train]
model.fit(X, y, sample_weight=sample_weights)
```

**C. SMOTE (Synthetic Minority Oversampling)**
```python
from imblearn.over_sampling import SMOTE
X_resampled, y_resampled = SMOTE().fit_resample(X, y)
# –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ samples –¥–ª—è UP –∫–ª–∞—Å—Å–∞
```

**D. Focal Loss**
```python
# –í–º–µ—Å—Ç–æ log loss –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å focal loss
# –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ hard examples
loss = -Œ±¬∑(1-p)^Œ≥¬∑log(p)
```

**E. Threshold adjustment**
```python
# –û–±—É—á–∞—Ç—å—Å—è —Å balanced, –Ω–æ –¥–≤–∏–≥–∞—Ç—å –ø–æ—Ä–æ–≥ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
# predict = 1 if prob > threshold (–Ω–µ 0.5, –∞ –º–µ–Ω—å—à–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä 0.35)
```

**F. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤**
```python
# SMOTE + scale_pos_weight
# –∏–ª–∏ Focal Loss + threshold adjustment
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å

**1. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞**
- –ö–∞–∫–æ–π –∏–∑ A-F —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç–µ?
- –û–¥–∏–Ω –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é?

**2. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**
- –ü–æ—á–µ–º—É –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è (trading, 32/68 imbalance, XGBoost)
- –ü–ª—é—Å—ã/–º–∏–Ω—É—Å—ã –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

**3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã**
- –ï—Å–ª–∏ scale_pos_weight: –∫–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ? (2.13 –∏–ª–∏ –¥—Ä—É–≥–æ–µ?)
- –ï—Å–ª–∏ SMOTE: sampling_strategy?
- –ï—Å–ª–∏ Focal Loss: Œ±, Œ≥?
- –ï—Å–ª–∏ threshold: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?

**4. –ú–µ—Ç—Ä–∏–∫–∏**
- –ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∞–∂–Ω–µ–µ: precision, recall, F1 –¥–ª—è UP –∫–ª–∞—Å—Å–∞?
- –ò–ª–∏ profit factor –≤ trading –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ?

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```markdown
## –ó–ê–î–ê–ß–ê #3: CLASS IMBALANCE

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–µ—Ç–æ–¥
[A/B/C/D/E/F - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è]

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
[–ü–æ—á–µ–º—É –¥–ª—è trading —Å 32/68 imbalance]

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- parameter1: –∑–Ω–∞—á–µ–Ω–∏–µ
- parameter2: –∑–Ω–∞—á–µ–Ω–∏–µ

### –ü—Å–µ–≤–¥–æ–∫–æ–¥ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
```python
# –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏
[precision/recall/F1 –¥–ª—è UP? –∏–ª–∏ profit factor?]

### –†–∏—Å–∫–∏
[overfitting, —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω—ã, etc.]

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
[–µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, —á—Ç–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å]
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–ú–∏–Ω–∏–º—É–º:**
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ A-F
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 2-3 –º–µ—Ç–æ–¥–æ–≤
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
- –†–∏—Å–∫–∏

‚úÖ **–û—Ç–ª–∏—á–Ω–æ:**
- –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤
- –ü–ª–∞–Ω A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- Threshold optimization strategy

---

## üìä –ó–ê–î–ê–ß–ê #4: FEATURE SELECTION (–í–ê–ñ–ù–´–ô)

**–î–µ–¥–ª–∞–π–Ω:** 2025-11-17 20:00
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –í–´–°–û–ö–ò–ô
**–í—Ä–µ–º—è:** 6-8 —á–∞—Å–æ–≤
**–ù—É–∂–Ω–æ –¥–ª—è:** –î–µ–Ω—å 4 - OpportunityScorer —Å 10-15 –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–î–ª—è OpportunityScorer –µ—Å—Ç—å 38 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç MATHEMATICAL_FOUNDATION_FOR_PJS.md, —Ä–∞–∑–¥–µ–ª 4.2).

**–°–µ–π—á–∞—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ 4 –ø—Ä–∏–∑–Ω–∞–∫–∞ (RSI, volume, EMA, ATR) - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è

**–ù—É–∂–Ω–æ:** –í—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ 10-15 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è 1MVP

### –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (38 total)

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (15):**
RSI, MACD, Stochastic, CCI, Williams %R, BB_width, BB_%B, Ichimoku (5 components), ADX, DI+, DI-

**Momentum/Trend (8):**
ROC, MOM, TRIX, VWAP, Parabolic SAR, Aroon_up, Aroon_down

**Volume/Liquidity (5):**
OBV, AccDist, Chaikin MF, VWAP, Spread

**Volatility (4):**
Historical Vol, ATR, True Range, Keltner

**Microstructure (6):**
Order imbalance, Trade aggression, Price impact, Tick direction, Time between trades, Order flow toxicity

### –î–∞–Ω–Ω—ã–µ

–£ –Ω–∞—Å –µ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ BTC 15m (275K —Å–≤–µ—á–µ–π) —Å —Ü–µ–Ω–æ–π –∏ –æ–±—ä—ë–º–æ–º.

**–ú–æ–∂–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å:** –≤—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (–ø–µ—Ä–≤—ã–µ 32 –ø—Ä–∏–∑–Ω–∞–∫–∞)
**–ù–ï –ú–û–ñ–ï–ú –≤—ã—á–∏—Å–ª–∏—Ç—å (–ø–æ–∫–∞):** microstructure (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 6) - –Ω—É–∂–Ω—ã order book –¥–∞–Ω–Ω—ã–µ (2MVP)

### –ú–µ—Ç–æ–¥—ã Feature Selection

**A. Filter methods**
- Mutual Information: I(X; y)
- Correlation with target
- Chi-squared test
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –±—ã—Å—Ç—Ä–æ
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

**B. Wrapper methods**
- Recursive Feature Elimination (RFE)
- Forward/Backward selection
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: —É—á–∏—Ç—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –¥–æ—Ä–æ–≥–æ (–º–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏–π)

**C. Embedded methods**
- LASSO (L1 regularization)
- Tree-based importance (XGBoost feature_importances_)
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –±—ã—Å—Ç—Ä–æ + —É—á–∏—Ç—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: bias –∫ –º–æ–¥–µ–ª–∏

**D. Domain knowledge**
- –≠–∫—Å–ø–µ—Ä—Ç—ã –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ

### –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å

**1. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞**
- –ö–∞–∫–æ–π –∏–∑ A/B/C/D (–∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è)?
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: domain ‚Üí LASSO ‚Üí RFE top 15 ‚Üí final 10)

**2. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞**
- –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ø-10 –∏–∑ 32? (–ø–æ—Ä–æ–≥ –≤–∞–∂–Ω–æ—Å—Ç–∏, threshold correlation)
- –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å multicollinearity? (RSI –∏ Stochastic —Å–∏–ª—å–Ω–æ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—Ç)

**3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º**
```python
def select_top_features(X: pd.DataFrame,
                        y: np.ndarray,
                        n_features: int = 10) -> List[str]:
    """
    –í—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ø n_features

    Returns:
        —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
    """
    # –í–∞—à –∞–ª–≥–æ—Ä–∏—Ç–º
```

**4. –í–∞–ª–∏–¥–∞—Ü–∏—è**
- –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ö–æ—Ä–æ—à–∏?
- Cross-validation? Out-of-time validation?

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```markdown
## –ó–ê–î–ê–ß–ê #4: FEATURE SELECTION

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –º–µ—Ç–æ–¥
[A/B/C/D –∏–ª–∏ pipeline]

### –ê–ª–≥–æ—Ä–∏—Ç–º (–ø–æ—à–∞–≥–æ–≤–æ)
1. –®–∞–≥ 1: [–º–µ—Ç–æ–¥, –∫—Ä–∏—Ç–µ—Ä–∏–π]
2. –®–∞–≥ 2: [–º–µ—Ç–æ–¥, –∫—Ä–∏—Ç–µ—Ä–∏–π]
3. Final: —Ç–æ–ø-10 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞
[importance threshold, correlation threshold, etc.]

### –†–∞–±–æ—Ç–∞ —Å multicollinearity
[–∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –∏–ª–∏ —É—á–µ—Å—Ç—å]

### –ü—Å–µ–≤–¥–æ–∫–æ–¥
```python
def select_top_features(...):
    # –í–∞—à –∫–æ–¥
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è
[–∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–±–æ—Ä–∞]

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º
[–µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å domain knowledge –¥–ª—è trading - –∫–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤–∞–∂–Ω–µ–µ]
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–ú–∏–Ω–∏–º—É–º:**
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞
- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞

‚úÖ **–•–æ—Ä–æ—à–æ:**
- –ü—Å–µ–≤–¥–æ–∫–æ–¥
- –†–∞–±–æ—Ç–∞ —Å multicollinearity
- –ü–ª–∞–Ω –≤–∞–ª–∏–¥–∞—Ü–∏–∏

‚úÖ **–û—Ç–ª–∏—á–Ω–æ:**
- Pipeline –∏–∑ 2-3 –º–µ—Ç–æ–¥–æ–≤
- –¢–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Python
- –¢–æ–ø-15 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è trading

---

## üìä –ó–ê–î–ê–ß–ò #5-7 (–°–†–ï–î–ù–ò–ô/–ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

–≠—Ç–∏ –∑–∞–¥–∞—á–∏ –º–æ–∂–Ω–æ —Ä–µ—à–∞—Ç—å –ø–æ—Å–ª–µ 2025-11-17 –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–ª—è 1MVP.

### –ó–ê–î–ê–ß–ê #5: Weight Optimization (OpportunityScorer)
- –ö–∞–∫ –Ω–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ w_i –¥–ª—è opportunity = ‚àëw_i¬∑f_i?
- Gradient descent, Bayesian optimization, –∏–ª–∏ evolutionary algorithms?

### –ó–ê–î–ê–ß–ê #6: OOD Detection Alternatives
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã 3œÉ –ø—Ä–∞–≤–∏–ª—É: Mahalanobis distance, Isolation Forest, Autoencoders?
- –î–ª—è non-stationary crypto markets —Å fat tails

### –ó–ê–î–ê–ß–ê #7: Hybrid Layer Optimization
- Optimal –ø–æ—Ä—è–¥–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (Rule ‚Üí ML ‚Üí Crisis) vs (Crisis ‚Üí Rule ‚Üí ML)?
- Minimize compute –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º WR

**–ï—Å–ª–∏ —É—Å–ø–µ–µ—Ç–µ** - –æ—Ç–ª–∏—á–Ω–æ! –ï—Å–ª–∏ –Ω–µ—Ç - –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, —Å–¥–µ–ª–∞–µ–º —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏.

---

## üìã –§–û–†–ú–ê–¢ –ò–¢–û–ì–û–í–û–ì–û –î–û–ö–£–ú–ï–ù–¢–ê

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–±–µ—Ä–∏—Ç–µ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç:

```markdown
# –û–¢–í–ï–¢–´ –ú–ê–¢–ï–ú–ê–¢–ò–ö–û–í - SCARLET SAILS

**–î–∞—Ç–∞:** 2025-11-15
**–ê–≤—Ç–æ—Ä—ã:** [–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞]

---

## –ó–ê–î–ê–ß–ê #1: REGIME DETECTION
[–í–∞—à –æ—Ç–≤–µ—Ç –ø–æ —à–∞–±–ª–æ–Ω—É –≤—ã—à–µ]

---

## –ó–ê–î–ê–ß–ê #2: RISK AGGREGATION
[–í–∞—à –æ—Ç–≤–µ—Ç]

---

## –ó–ê–î–ê–ß–ê #3: CLASS IMBALANCE
[–í–∞—à –æ—Ç–≤–µ—Ç]

---

## –ó–ê–î–ê–ß–ê #4: FEATURE SELECTION (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
[–í–∞—à –æ—Ç–≤–µ—Ç]

---

## –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

[–ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –∏–¥–µ–∏, —É–ª—É—á—à–µ–Ω–∏—è, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è]

---

## –í–û–ü–†–û–°–´ –ö –í–ê–ú

[–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ]
```

---

## üîó –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

### –î–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ

1. **MATHEMATICAL_FOUNDATION_FOR_PJS.md** - –ø–æ–ª–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
2. **P_j_S_FORMULA_ANALYSIS.md** - –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—É–ª—ã P_j(S)
3. **comprehensive_model_audit.json** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
4. **models/pjs_components.py** - —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è)

```bash
# –î–ª—è HMM
pip install hmmlearn

# –î–ª—è Regime-switching
pip install arch

# –î–ª—è SMOTE
pip install imbalanced-learn

# –î–ª—è feature selection
pip install scikit-learn
```

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)

–ú–æ–∂–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å:
- –ö–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö BTC_15m.csv
- –¢–µ–∫—É—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ penalties
- –ü—Ä–∏–º–µ—Ä—ã –æ–±—É—á–µ–Ω–∏—è XGBoost
- –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ

---

## ‚ùì –í–û–ü–†–û–°–´

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–º–µ—Ä—ã, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:

**–ö–æ–Ω—Ç–∞–∫—Ç:** –î–º–∏—Ç—Ä–∏–π (—á–µ—Ä–µ–∑ GitHub issue –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é)

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –æ–∫–∞–∂–µ—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ/–¥–æ–ª—å—à–µ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ - —Å–æ–æ–±—â–∏—Ç–µ —Å—Ä–∞–∑—É! –õ—É—á—à–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –î–õ–Ø –°–î–ê–ß–ò

–ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –ó–∞–¥–∞—á–∞ #1 (Regime Detection) - –ö–†–ò–¢–ò–ß–ù–û
  - [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
  - [ ] –§–æ—Ä–º—É–ª—ã/–ø—Å–µ–≤–¥–æ–∫–æ–¥
  - [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
  - [ ] –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –ó–∞–¥–∞—á–∞ #2 (Risk Aggregation) - –ö–†–ò–¢–ò–ß–ù–û
  - [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞
  - [ ] –§–æ—Ä–º—É–ª–∞ total_penalty
  - [ ] –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
  - [ ] –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞

- [ ] –ó–∞–¥–∞—á–∞ #3 (Class Imbalance) - –í–´–°–û–ö–ò–ô
  - [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞
  - [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
  - [ ] –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏

- [ ] –ó–∞–¥–∞—á–∞ #4 (Feature Selection) - –í–ê–ñ–ù–´–ô (–µ—Å–ª–∏ —É—Å–ø–µ–ª–∏)
  - [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞
  - [ ] –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞
  - [ ] –ü—Å–µ–≤–¥–æ–∫–æ–¥

- [ ] –ò—Ç–æ–≥–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ –≤—ã—à–µ
- [ ] –í–æ–ø—Ä–æ—Å—ã –∫ –Ω–∞–º (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å!** –í–∞—à–∞ —Ä–∞–±–æ—Ç–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è —É—Å–ø–µ—Ö–∞ –ø—Ä–æ–µ–∫—Ç–∞.

**–ì–ª–∞–≤–Ω–æ–µ:**
1. **–î–µ–¥–ª–∞–π–Ω 2025-11-15 20:00** –¥–ª—è –ó–∞–¥–∞—á #1-3 (48 —á–∞—Å–æ–≤)
2. **–ö–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —Å–∫–æ—Ä–æ—Å—Ç–∏** - –ª—É—á—à–µ –ø—Ä–æ—Å—Ç–æ–µ, –Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
3. **–°–æ–æ–±—â–∞–π—Ç–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö** - –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–¥—ë—Ç –Ω–µ —Ç–∞–∫, –ø–∏—à–∏—Ç–µ —Å—Ä–∞–∑—É

**–ú—ã –Ω–∞ —Å–≤—è–∑–∏!** –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–º–µ—Ä—ã, –∫–æ–¥ - –ø–∏—à–∏—Ç–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.

---

**–° —É–≤–∞–∂–µ–Ω–∏–µ–º,**
**–ö–æ–º–∞–Ω–¥–∞ Scarlet Sails**
