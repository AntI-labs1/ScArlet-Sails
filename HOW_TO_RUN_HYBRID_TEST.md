# ĞšĞ°Ğº Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚ Hybrid ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

## ğŸ¯ Ğ§Ñ‚Ğ¾ Ñƒ Ğ½Ğ°Ñ ĞµÑÑ‚ÑŒ

### 3 Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ«:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. RULE-BASED (master audit)               â”‚
â”‚    scripts/master_comprehensive_audit.py    â”‚
â”‚    âœ… Ğ£Ğ¶Ğµ Ğ¿Ñ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° (56 ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¹)    â”‚
â”‚    ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹: 7,464 Ñ‚Ñ€ĞµĞ¹Ğ´Ğ¾Ğ²            â”‚
â”‚       WR: 47.3%, PF: 1.17                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ML Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ (XGBoost Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾)           â”‚
â”‚    âœ… ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ° (xgboost_model.json)   â”‚
â”‚    ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹: 46 Ñ‚Ñ€ĞµĞ¹Ğ´Ğ¾Ğ²               â”‚
â”‚       WR: 60.9%, PF: 2.12                   â”‚
â”‚    âš ï¸  ĞœĞ°Ğ»Ğ¾ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² (Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. HYBRID (ĞĞĞ’ĞĞ¯ - Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ 1 + 2)      â”‚
â”‚    scripts/hybrid_backtest.py               â”‚
â”‚    ğŸ†• Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°                    â”‚
â”‚    ğŸ“Š ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾: ~3,000 Ñ‚Ñ€ĞµĞ¹Ğ´Ğ¾Ğ²             â”‚
â”‚       WR: 55-60%, PF: 1.8-2.0               â”‚
â”‚    ğŸ’¡ Ğ›ÑƒÑ‡ÑˆĞµĞµ Ğ¸Ğ· Ğ´Ğ²ÑƒÑ… Ğ¼Ğ¸Ñ€Ğ¾Ğ²                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ĞšĞ°Ğº Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Hybrid Ñ‚ĞµÑÑ‚

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ (Ñ Ğ²Ğ°ÑˆĞ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸)

```bash
# 1. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ Ñ‡Ñ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ
ls data/raw/        # Ğ”Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ .parquet Ñ„Ğ°Ğ¹Ğ»Ñ‹
ls data/features/   # Ğ˜Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ Ñ„Ğ¸Ñ‡Ğ°Ğ¼Ğ¸

# 2. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ñ‚ĞµÑÑ‚
python scripts/hybrid_backtest.py

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
cat reports/hybrid_backtest/hybrid_backtest_results.json
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Ğ•ÑĞ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµÑ‚ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾

```bash
# Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‡ĞµÑ€ĞµĞ· DVC
dvc pull data/raw

# Ğ—Ğ°Ñ‚ĞµĞ¼ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ
python scripts/hybrid_backtest.py
```

---

## ğŸ“Š Ğ§Ñ‚Ğ¾ Ğ²Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ

### 1. ĞšĞ¾Ğ½ÑĞ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´

```
Testing: BTC_15m
   âœ… Loaded features: 250,000 bars
   Generating signals...
   âœ… Generated 1,234 signals      â† ĞœĞµĞ½ÑŒÑˆĞµ Ñ‡ĞµĞ¼ 7,464 (ML Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚!)
   Backtesting...
   âœ… Executed 1,156 trades

   RESULTS:
   Trades:        1,156
   Win Rate:      56.2%            â† Ğ’Ñ‹ÑˆĞµ Ñ‡ĞµĞ¼ 47.3% (ML ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ğ» ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾!)
   Profit Factor: 1.87             â† Ğ’Ñ‹ÑˆĞµ Ñ‡ĞµĞ¼ 1.17 (Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ edge!)
   Total Return:  142.3%
```

### 2. JSON Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚

`reports/hybrid_backtest/hybrid_backtest_results.json`:

```json
[
  {
    "asset": "BTC",
    "timeframe": "15m",
    "data_bars": 250000,
    "signals_generated": 1234,
    "total_trades": 1156,
    "win_rate": 0.562,
    "profit_factor": 1.87,
    "total_return": 1.423
  },
  ...
]
```

### 3. CSV Ñ„Ğ°Ğ¹Ğ»

`reports/hybrid_backtest/hybrid_backtest_results.csv` - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ² Excel

### 4. Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
HYBRID SYSTEM FILTERING STATISTICS
============================================================
Total checks:     250,000
Layer 1 (Rules):  7,464 passed (2.9%)   â† RSI < 30
Layer 2 (ML):     3,218 passed (43.1% of Layer 1)   â† XGBoost Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€
Layer 3 (Crisis): 2,987 passed (92.8% of Layer 2)   â† Crisis protection

Overall:          2,987 / 250,000 passed (1.2%)
Signal reduction: 98.8%
============================================================
```

---

## âš–ï¸ Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ baseline

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Rule-based (ÑÑ‚Ğ°Ñ€Ğ°Ñ) | Hybrid (Ğ½Ğ¾Ğ²Ğ°Ñ) | Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ |
|---------|---------------------|----------------|-----------|
| **Trades** | 7,464 | ~3,000 | -60% (Ğ¼ĞµĞ½ÑŒÑˆĞµ ÑˆÑƒĞ¼Ğ°) |
| **Win Rate** | 47.3% | 55-60% | +8-13% (Ğ»ÑƒÑ‡ÑˆĞµ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾) |
| **Profit Factor** | 1.17 | 1.8-2.0 | +54-71% (ÑĞ¸Ğ»ÑŒĞ½ĞµĞµ edge) |
| **Crisis Protection** | âŒ ĞĞµÑ‚ | âœ… Ğ•ÑÑ‚ÑŒ | Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ĞºÑ€Ğ°Ñ…Ğ¾Ğ² |

---

## ğŸ”§ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²

Ğ’ `scripts/hybrid_backtest.py` Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ:

```python
# ML Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€
ML_THRESHOLD = 0.6  # 0.5 = Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ², 0.8 = Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½ĞµĞµ
ENABLE_ML_FILTER = True  # False = Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Layer 2

# Crisis protection
ENABLE_CRISIS_GATE = True  # False = Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Layer 3
```

---

## â“ FAQ

### Q: ĞÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¾Ğ±ÑƒÑ‡Ğ°Ñ‚ÑŒ XGBoost?
**A:** ĞĞ•Ğ¢! ĞœĞ¾Ğ´ĞµĞ»ÑŒ ÑƒĞ¶Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ° (`models/xgboost_model.json`). Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ĞµÑ‘.

### Q: ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ°Ğº Ğ¼Ğ°Ğ»Ğ¾ Ñ‚Ñ€ĞµĞ¹Ğ´Ğ¾Ğ² Ğ² Hybrid?
**A:** ĞŸĞ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ ML Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ ĞĞ¢Ğ¡Ğ•Ğ˜Ğ’ĞĞ•Ğ¢ Ğ¿Ğ»Ğ¾Ñ…Ğ¸Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ñ‹. ĞœĞµĞ½ÑŒÑˆĞµ Ñ‚Ñ€ĞµĞ¹Ğ´Ğ¾Ğ² = Ğ²Ñ‹ÑˆĞµ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾.

### Q: ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ±ĞµĞ· ML?
**A:** Ğ”Ğ°, ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ `ENABLE_ML_FILTER = False`. Ğ¢Ğ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ Ñ‚Ğµ Ğ¶Ğµ 7,464 Ñ‚Ñ€ĞµĞ¹Ğ´Ğ¾Ğ².

### Q: Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² DVC Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ?
**A:**
```bash
# Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ DVC:
dvc pull data/raw

# Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ DVC:
# Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ .parquet Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² data/raw/ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
```

### Q: ĞšĞ°Ğº Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ ML Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?
**A:** Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ½Ğ° "Layer 2 pass rate" Ğ² ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞµ. Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ 40-60% (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¾Ñ‚ÑĞµĞºĞ°ĞµÑ‚ 40-60% ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²).

---

## ğŸ“ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. âœ… **Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ñ‚ĞµÑÑ‚** - `python scripts/hybrid_backtest.py`
2. âœ… **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹** - `reports/hybrid_backtest/`
3. âœ… **Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚Ğµ Ñ baseline** - `reports/master_audit/raw_results.json`
4. â³ **Day 2: Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚Ğµ feature extraction** (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)

---

## ğŸ“ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Hybrid ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ±Ğ°Ñ€ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ñ‡ĞµÑ€ĞµĞ· 3 ÑĞ»Ğ¾Ñ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Rule Check                 â”‚
â”‚ if RSI < 30:                        â”‚  â† 7,464 ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² (2.9%)
â”‚   PASS to Layer 2                   â”‚
â”‚ else:                               â”‚
â”‚   REJECT                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: ML Filter                  â”‚
â”‚ features = extract(bar)             â”‚  â† 3,000 ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² (40% Ğ¾Ñ‚ Layer 1)
â”‚ ml_score = xgboost.predict(features)â”‚
â”‚ if ml_score > 0.6:                  â”‚
â”‚   PASS to Layer 3                   â”‚
â”‚ else:                               â”‚
â”‚   REJECT                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Crisis Gate                â”‚
â”‚ if crisis_detected():               â”‚  â† 2,800 ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ² (93% Ğ¾Ñ‚ Layer 2)
â”‚   REJECT (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°!)                  â”‚
â”‚ else:                               â”‚
â”‚   EXECUTE TRADE âœ…                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Ready to test?** ğŸš€

```bash
python scripts/hybrid_backtest.py
```
